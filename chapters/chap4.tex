\chapter{データ処理・解析・分光観測}
\label{chap_4}
    \section{光とは}
    \label{sec_4_1}
    
    \section{分光とは}
    \label{sec_4_2}
    我々が受け取る光は大抵の場合、単一の振動数ではなく異なる振動数の波が重なった光
    となっている。太陽光が身近な一例で、一見すると白色に見えるが雨上がりの
    虹を見ると「七色」に見える。つまりこれは太陽の光が「七色」の光が重なり合ったものであるということを意味している。
    「分光観測」とはまさしく虹が起こるメカニズムを利用した観測手法である。そのメカニズムというのはざっくりと言うと「異なる波長の光が重なった光を波長毎に分けよう」という試みである。
    
    もう少し物理的に言うと異なる屈折率の媒質中に光が入射するとSnellの法則に従って屈折が生じ、その屈折角が光の波長によって異なっていることを利用しているのである。
    \section{分光の目的}
    ではなぜわざわざ分光するのかというと
    \begin{itemize}
        \item 天体がどのようにして光っているのか?
        \item 光を発する天体がどのような状態(速度分散)になっているのか?
        \item 天体やその天体までの間の空間にどのような物質があるのか?
        \item 天体と地球はどれほど離れているか?~~~~~etc...
    \end{itemize}
    といった疑問を解決するための情報が分光観測によって得られるからである。
    これらの情報がどうして得られるのかの詳細は輻射過程の本に委ねるが、以下では分光観測をする上で知っておくべき物理の基礎をざっとまとめる。
    
    
    
    
    
    分光するといっても様々な手法がある。大きく分散型と干渉型の２つに分かれる。宇宙では干渉型、地上では分散型が用いられていて、これは分光装置が打ち上げに耐えられないためである。
    分散型の中でもグリズム(グレーティング)とプリズムの2種類の分散素子がある。その違いは分散の幅が線形(グリズム)か非線形(プリズム)であるかの違いである。
    
    
    一つの星を指定して分光する方法はスリットを使う方法とファイバーを使い方法に分けられる。ここでは仙台市天文台の分光装置に使われているスリットについて説明する。
    
    装置の
    スリットの幅は広いと光量が増える反面、分解能は低下する。対して幅を狭くすると光量が減る反面分解能が上がる。このようにスリット幅を変えることで目的や目標天体にあった観測をすることが出来る。もちろん観測計画を立てるときはスリット幅をどうするかということを考える必要がある。
    
    
\section{撮像と分光スペクトル}
\label{sec_4_3}
    
\section{分光におけるデータ処理の必要性}
\label{sec_4_4}
    
\section{分光スペクトルに乗るノイズ}
\label{sec_4_5}
    
\section{分光データの一次処理}
\label{sec_4_6}
ここからは、実際のデータ解析に移ります。分光観測のデータ処理は撮像と同じく$1$次処理

\subsection{IRAFでのダーク引き}
\label{subsec_4_6_1}
「\textbf{ダーク}」はカメラのシャッター、または望遠鏡の蓋を閉じた状態で、\textbf{天体の露出時間と同じ時間撮影を行う}ことによって出力されるものである。まずは出力されたダークのデータから、そのままダーク画像を表示することを考える。
    
    分光はirafを用いて行う。そのため、ダーク引きもiraf上での作業が必要となる。
    今回扱うデータは次のようになっている。
    \begin{table} 
	    \centering
	    \caption{今回扱う分光処理のデータ}
	    \footnotesize 
    	\label{tab_4_1}
	    \begin{tabular}{cccc} 
		    \hline
		    \shortstack{hoge} &
		    \shortstack{hoge} &
		    \shortstack{hoge} &
		    \shortstack{hoge} 
	    	\\
	    	\hline
	    	hoge & hoge & hoge & hoge\\
	    	\hline
    	\end{tabular}
    	\normalsize 
    \end{table}
    ここでは例として、wr4\_1.fitsを分光する流れを説明していく。まずはダーク画像を重ね合わせによって作成する。処理する画像と同じ積分時間のダークのリストを作成し、irafを用いて重ね合わせを行う。
\begin{screen}
\begin{verbatim}
cl> ls -1 ../rawdata/dark*180.fit > dark180.lst
cl> epar imcombine\end{verbatim}
\end{screen}
    とすれば、iraf上での画像重ね合わせ時のパラメータを編集できる画面へと移行する。

\begin{screen}
\tiny{
\begin{verbatim}
                                   I R A F  
                    Image Reduction and Analysis Facility
PACKAGE = immatch
   TASK = imcombine
    
input   =                       List of images to combine
output  =                       List of output images
(headers=                     ) List of header files (optional)
(bpmasks=                     ) List of bad pixel masks (optional)
(rejmask=                     ) List of rejection masks (optional)
(nrejmas=                     ) List of number rejected masks (optional)
(expmask=                     ) List of exposure masks (optional)
(sigmas =                     ) List of sigma images (optional)
(imcmb  =                   $I) Keyword for IMCMB keywords
(logfile=               STDOUT) Log file
(combine=              average) Type of combine operation
(reject =                     ) Type of rejection
(project=                   no) Project highest dimension of input images?
(outtype=                 real) Output image pixel datatype
(outlimi=                     ) Output limits (x1 x2 y1 y2 ...)
(offsets=                 none) Input image offsets
(masktyp=                 none) Mask type
(maskval=                    0) Mask value
(blank  =                   0.) Value if there are no pixels
(scale  =                 none) Image scaling
(zero   =                 none) Image zero point offset
(weight =                 none) Image weights
(statsec=                     ) Image section for computing statistics
(expname=                     ) Image header exposure time keyword
(lthresh=                INDEF) Lower threshold
(hthresh=                INDEF) Upper threshold
(nlow   =                    1) minmax: Number of low pixels to reject
(nhigh  =                    1) minmax: Number of high pixels to reject
(nkeep  =                    1) Minimum to keep (pos) or maximum to reject (neg)
(mclip  =                  yes) Use median in sigma clipping algorithms?
(lsigma =                   3.) Lower sigma clipping factor

(hsigma =                   3.) Upper sigma clipping factor
(rdnoise=                   0.) ccdclip: CCD readout noise (electrons)
(gain   =                   1.) ccdclip: CCD gain (electrons/DN)
(snoise =                   0.) ccdclip: Sensitivity noise (fraction)
(sigscal=                  0.1) Tolerance for sigma clipping scaling corrections
(pclip  =                 -0.5) pclip: Percentile clipping parameter
(grow   =                   0.) Radius (pixels) for neighbor rejection
(mode   =                   ql)

More                                                                            
                                                             ESC-? for HELP
\end{verbatim}  
}
\end{screen}
    ここでは先程作ったダークのリスト(dark180.lst)を用いて、medianからの3$\sigma$クリッピングを用いた処理を行い、dark180.fitsという画像データに落とし込むため以下のようにパラメータを変更する必要がある。
\begin{screen}
\begin{verbatim}
input   =         @dark180.lst  List of images to combine 
output  =         dark180.fits  List of output images
(combine=               median) Type of combine operation
(reject =              sigclip) Type of rejection
(lsigma =                   3.) Lower sigma clipping factor
(hsigma =                   3.) Upper sigma clipping factor
\end{verbatim}
\end{screen}
これらを変更したら、「:go」を入力せよ。
\begin{screen}
\small{
\begin{verbatim}
Sep 24 14:59: IMCOMBINE
  combine = median, scale = none, zero = none, weight = none
  reject = sigclip, mclip = yes, nkeep = 1
  lsigma = 3., hsigma = 3.
  blank = 0.
                Images 
  ../rawdata/dark-001_180s.fit
  ../rawdata/dark-002_180s.fit
  ../rawdata/dark-003_180s.fit
  ../rawdata/dark-004_180s.fit
  ../rawdata/dark-005_180s.fit
  ../rawdata/dark-006_180s.fit
  ../rawdata/dark-007_180s.fit
  ../rawdata/dark-008_180s.fit
  ../rawdata/dark-009_180s.fit
  ../rawdata/dark-010_180s.fit

  Output image = dark180.fits, ncombine = 10
\end{verbatim}
}
\end{screen}
    すると上記のようなメッセージが流れ、画像が出力される。おめでとう！\\
    次に、作成したダークを分光したい画像から差し引こう。ここではirafに用意されている画像演算用コマンド imarith を用いて処理をおこなう。
\begin{screen}
\small{
\begin{verbatim}
                                   I R A F  
                    Image Reduction and Analysis Facility
PACKAGE = imutil
   TASK = imarith

operand1= ../rawdata/wr4_1.fit  Operand image or numerical constant
op      =                    -  Operator
operand2=         dark180.fits  Operand image or numerical constant
result  =             dr4.fits  Resultant image
(title  =                     ) Title for resultant image
(divzero=                   0.) Replacement value for division by zero
(hparams=                     ) List of header parameters
(pixtype=                     ) Pixel type for resultant image
(calctyp=                     ) Calculation data type
(verbose=                   no) Print operations?
(noact  =                   no) Print operations without performing them?
(mode   =                   ql)
\end{verbatim}
}
\end{screen}
    上記のように入力することで
    
    \begin{figure}
	    \centering
	    \subfigure[]{%
    	\includegraphics[width=.4\textwidth,clip]{fig/chap4/ds9_wr4.png}%
	    \label{fig_4_6_1}%
	    }%
    	\subfigure[]{%
	    \includegraphics[width=.4\textwidth,clip]{fig/chap4/ds9_dwr4.png}%
    	\label{fig_4_6_2}%
    	}
    	\caption[生画像とダークを差し引いた画像]{生画像とダークを差し引かいた画像。(a)生データ、(b)ダーク引き後。}
    	\label{fig_4_6}
    \end{figure}
    \begin{align*}
    \mathrm{Operand1}\mspace{10mu}+/-/\times/\div(\mathrm{op})\mspace{10mu} \mathrm{Operand}2 = \mathrm{result}
    \end{align*}
\section*{まとめ}
    
\addcontentsline{toc}{section}{まとめ} % 目次に載せる
    
    